<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>損益額計算機</title>
    <style>
        /* 全体的に余白を削り、スクロール不要なサイズに調整 */
        body { font-family: sans-serif; padding: 10px; background: #f0f4f8; margin: 0; }
        .box { background: white; padding: 15px 20px; border-radius: 12px; max-width: 380px; margin: auto; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; margin: 0 0 12px 0; color: #2c3e50; font-size: 20px; }
        .type-select-group { margin-bottom: 12px; } 
        .formula { background: #fff9db; padding: 8px; font-size: 11px; text-align: center; font-weight: bold; border-radius: 6px; color: #856404; border: 1px solid #ffeeba; min-height: 1.2em; }
        label { display: block; margin-top: 8px; font-weight: bold; font-size: 13px; color: #444; }
        input, select { width: 100%; padding: 8px; margin-top: 3px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 6px; font-size: 15px; }
        .live-preview { font-size: 11px; color: #666; margin-top: 2px; text-align: right; min-height: 13px; }
        .result-area { margin-top: 15px; padding: 12px; background: #e6fffa; border: 2px solid #38b2ac; border-radius: 10px; text-align: center; }
        #resultValue { font-size: 30px; font-weight: bold; color: #2c7a7b; }
        .res-label { font-size: 13px; color: #2c7a7b; margin-bottom: 2px; }
        .note { font-size: 11px; color: #999; text-align: center; margin-top: 8px; }

        /* ボタンエリア（hrなし、余白縮小） */
        .link-container { text-align: center; margin-top: 15px; }
        .btn-link {
            display: inline-block; 
            padding: 10px 30px; 
            background-color: #38b2ac; 
            color: white; 
            text-decoration: none; 
            border-radius: 25px; 
            font-weight: bold; 
            font-size: 15px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .btn-link:hover { transform: scale(1.02); }
    </style>
</head>
<body>

<div class="box">
    <h2>損益額計算機</h2>
    <div class="type-select-group">
        <label>計算タイプ</label>
        <select id="type" onchange="changeType()">
            <option value="jpy">クロス円 (USD/JPY等)</option>
            <option value="usd">ドルストレート (EUR/USD等)</option>
            <option value="eurgbp">ユーロポンド (EUR/GBP)</option>
        </select>
    </div>
    <div class="formula" id="formula">式 : |エントリーレート - 決済レート| × 数量</div>

    <label>エントリーレート</label>
    <input type="number" id="entry" value="150.000" step="0.00001" oninput="run()">
    <label>決済レート</label>
    <input type="number" id="settle" value="150.500" step="0.00001" oninput="run()">
    
    <label>数量 (通貨)</label>
    <input type="number" id="qty" value="10000" oninput="run()">
    <div id="qtyPreview" class="live-preview">10,000 通貨</div>

    <div id="rateBox" style="display:none;">
        <label id="rateLabel">現在のドル円レート</label>
        <input type="number" id="baseRate" value="150.00" step="0.01" oninput="run()">
    </div>

    <div class="result-area">
        <div class="res-label">予想される損益額</div>
        <span id="resultValue">5,000</span> <span style="font-size:18px; font-weight:bold; color:#2c7a7b;">円</span>
    </div>
    <div class="note">※ | | は絶対値（差の大きさ）を表します</div>

    <div class="link-container">
        <a href="index.html" class="btn-link">損益pips計算機はこちらへ</a>
    </div>
</div>

<script>
function changeType() {
    const type = document.getElementById('type').value;
    const formula = document.getElementById('formula');
    const rateBox = document.getElementById('rateBox');
    const rateLabel = document.getElementById('rateLabel');
    const entry = document.getElementById('entry');
    const settle = document.getElementById('settle');
    const baseRate = document.getElementById('baseRate');

    entry.step = "0.00001";
    settle.step = "0.00001";

    if (type === 'eurgbp') {
        formula.innerText = "式 : |レート差| × 数量 × ポンド円レート";
        rateLabel.innerText = "現在のポンド円レート";
        rateBox.style.display = 'block';
        if (parseFloat(entry.value) > 2) {
            entry.value = "0.85000";
            settle.value = "0.85500";
            baseRate.value = "200.00"; 
        }
    } else if (type === 'usd') {
        formula.innerText = "式 : |レート差| × 数量 × ドル円レート";
        rateLabel.innerText = "現在のドル円レート";
        rateBox.style.display = 'block';
        if (parseFloat(entry.value) > 2) {
            entry.value = "1.08500";
            settle.value = "1.08800";
            baseRate.value = "150.00";
        }
    } else {
        formula.innerText = "式 : |エントリーレート - 決済レート| × 数量";
        rateBox.style.display = 'none';
        if (parseFloat(entry.value) < 2) {
            entry.value = "150.000";
            settle.value = "150.500";
        }
    }
    run();
}

function run() {
    const type = document.getElementById('type').value;
    const entry = parseFloat(document.getElementById('entry').value) || 0;
    const settle = parseFloat(document.getElementById('settle').value) || 0;
    const qty = parseFloat(document.getElementById('qty').value) || 0;
    const baseRate = parseFloat(document.getElementById('baseRate').value) || 1;
    const resultEl = document.getElementById('resultValue');

    document.getElementById('qtyPreview').innerText = qty.toLocaleString() + " 通貨";

    let ans = Math.abs(entry - settle) * qty;
    if (type === 'usd' || type === 'eurgbp') {
        ans = ans * baseRate;
    }
    resultEl.innerText = Math.round(ans).toLocaleString();
}
window.onload = run;
</script>

</body>
</html>
